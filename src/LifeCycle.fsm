header {
    namespace hc {
        class Application;
    }

    typedef hc::Application Application;
    typedef char const* const_cstr;
}

cpp {
    #include "Application.h"
}

fsm LifeCycle {
    class Application as ctx;

    Start {
        loadConsole(const_cstr name) => ConsoleLoaded {
            if (!ctx.loadConsole(name)) {
                forbid;
            }
        }

        quit() => Quit;
    }

    Quit {}

    ConsoleLoaded {
        unloadConsole() => Start {
            ctx.unloadConsole();
        }

        loadGame(const_cstr path) => GamePaused {
            if (!ctx.loadGame(path)) {
                forbid;
            }
        }

        quit() => unloadConsole() => quit();
    }

    GamePaused {
        resumeGame() => GameRunning {
            if (!ctx.resumeGame()) {
                forbid;
            }
        }

        resetGame() => GamePaused {
            if (!ctx.resetGame()) {
                forbid;
            }
        }

        step() => GamePaused  {
            ctx.step();
        }

        unloadGame() => ConsoleLoaded {
            if (!ctx.unloadGame()) {
                forbid;
            }
        }

        quit() => unloadGame() => quit();
    }

    GameRunning {
        pauseGame() => GamePaused {
            if (!ctx.pauseGame()) {
                forbid;
            }
        }

        resetGame() => GameRunning {
            ctx.resetGame();
        }

        unloadGame() => ConsoleLoaded {
            if (!ctx.unloadGame()) {
                forbid;
            }
        }

        quit() => unloadGame() => quit();
    }
}
